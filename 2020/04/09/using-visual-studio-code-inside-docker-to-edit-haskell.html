<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Using Visual Studio Code Inside Docker To Edit Haskell | Dave Compton</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Using Visual Studio Code Inside Docker To Edit Haskell" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Intro" />
<meta property="og:description" content="Intro" />
<meta property="og:site_name" content="Dave Compton" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-09T19:39:18-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Using Visual Studio Code Inside Docker To Edit Haskell" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-04-09T19:39:18-07:00","datePublished":"2020-04-09T19:39:18-07:00","description":"Intro","headline":"Using Visual Studio Code Inside Docker To Edit Haskell","mainEntityOfPage":{"@type":"WebPage","@id":"/2020/04/09/using-visual-studio-code-inside-docker-to-edit-haskell.html"},"url":"/2020/04/09/using-visual-studio-code-inside-docker-to-edit-haskell.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dave Compton" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dave Compton</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Using Visual Studio Code Inside Docker To Edit Haskell</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-04-09T19:39:18-07:00" itemprop="datePublished">
        Apr 9, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="intro">Intro</h1>

<p>This blog post describes a way to use Vscode from inside of Docker to edit and debug Haskell.   The technique described will (probably) only work on a linux system because it depends on X tunneling to display the vscode window.</p>

<h1 id="prerequisites">Prerequisites</h1>
<ul>
  <li>A linux desktop computer with docker installed.</li>
</ul>

<p>I installed docker-ce per these instructions: <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository">https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository</a></p>

<h1 id="overview">Overview</h1>
<p>Build a haskell development Docker image, “haskell” .</p>

<p>The haskell image:</p>
<ul>
  <li>is based on Ubuntu 19.10</li>
  <li>runs sshd to provide for logging in from the host.</li>
  <li>contains a user with the same name/id as you have on your host.</li>
  <li>has tmux installed</li>
  <li>has stack installed</li>
  <li>has vscode installed</li>
  <li>includes utilities and vscode extensions for Haskell development.</li>
</ul>

<p>Start a container from the “haskell” image and then ssh into it from the host machine.  Because the user id in the container matches the host user id, shells running on the container have the same access to mounted files as on the host.  Tmux allows creation of multiple windows from inside the ssh login.  The ssh -Y option lets X windows (such as vscode) display on the host machine.</p>

<p>This (probably) will only work on Linux hosts.  I am using Ubuntu 16.04 with the docker community edition (installation instructions here). : <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository">https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository</a></p>

<h1 id="published-code">Published Code</h1>

<p>All of the code in this post is published on github:</p>
<ul>
  <li><a href="https://github.com/dc25/haskelldev">https://github.com/dc25/haskelldev</a></li>
</ul>

<h1 id="useful-bash-shell-functions">Useful Bash Shell Functions</h1>
<p>The following bash shell functions are used in this post:</p>
<ul>
  <li>dob : wrapper around docker build</li>
  <li>dor : wrapper around docker run</li>
  <li>dosh : wrapper around ssh</li>
</ul>

<p>All of these aliases are available in the file aliases.docker :</p>

<div class="code-container" style="height:560px">
  <iframe class="code-text" src="https://dc25.github.io/showCode?codeURL=https%3A%2F%2Fraw.githubusercontent.com%2Fdc25%2Fhaskelldev%2Fmaster%2Faliases.docker"></iframe>
  <hr />
  <div class="code-bar">
	  <a href="https://github.com/dc25/haskelldev/blob/master/aliases.docker" class="code-link">aliases.docker</a>
	  <a href="https://raw.githubusercontent.com/dc25/haskelldev/master/aliases.docker" class="code-raw-link">view raw</a>
  </div>
</div>
<p><br /></p>

<h1 id="building-the-haskell-image">Building the “haskell” Image</h1>

<p>Use the dob alias to build the “haskell” image, as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git clone https://github.com/dc25/haskelldev.git
<span class="nv">$ </span><span class="nb">cd </span>haskelldev 
<span class="nv">$ </span><span class="nb">.</span> aliases.docker
<span class="nv">$ </span>dob haskell </code></pre></figure>

<p>On my computer, this took about an hour and used about 14 gigabytes of disk space.  When this is done you should have a docker image named “haskell”.</p>

<p>The Dockerfile in the haskelldev repository expects your userid, username, and .ssh public key as build command line arguments. The dob alias provides those arguments.</p>

<h1 id="running-the-haskell-image">Running the “haskell” image.</h1>

<p>The dor bash function starts a container based on the “haskell” image as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>dor haskell</code></pre></figure>

<p>In the container, the ‘dor’ function invokes a script called start.sh . That script starts a ssh daemon that enables ssh access to the running container.</p>

<p>If you want to access a directory on the host machine from inside the container, a mount can be specified a run time ( when running the function, ‘dor’ ).  For example:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/workarea
<span class="nv">$ </span>dor haskell <span class="nt">-v</span> <span class="nv">$HOME</span>/workarea:/haskell_workarea</code></pre></figure>

<p>Directories mounted in this way will have the same accessibility in the container as on the host machine.</p>

<h1 id="logging-in-to-the-container">Logging in to the container</h1>
<p>Use the dosh bash function to log into the running container.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>dosh</code></pre></figure>

<p>If all went well, your terminal should contain a shell prompt running in a tmux environment in the container.  Inside this environment, you can use tmux to create new windows as well as other useful operations.  See tmux documentation for more info.</p>

<h1 id="haskell-development">Haskell Development</h1>

<p>To develop in haskell I use the following tools:</p>

<ul>
  <li>stack</li>
  <li>vscode</li>
  <li>hie ( Haskell Ide Engine )</li>
  <li>ghcide (seems to be expected by other vscode plugins)</li>
  <li>Haskell GHCi Debug Adapter Phoityne (for interactive debugging)</li>
  <li>Haskell Language Server Client (vscode plugin to work with hie)</li>
  <li>Haskell Syntax Highlighting</li>
</ul>

<p>If anyone reading this know of any other tools that would complement this set, please let me know.</p>

<p>From inside the ssh session, use stack, vscode.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> /workarea
<span class="err">$</span>
<span class="nv">$ </span>stack new sampleProject 
<span class="err">$</span>
<span class="nv">$ </span><span class="nb">cd </span>sampleProject
<span class="nv">$ </span>
<span class="nv">$ </span><span class="c"># Do stack build for some setup expected by the vscode environment.</span>
<span class="nv">$ </span>stack build 
<span class="nv">$ </span>stack build <span class="nt">--test</span>
<span class="err">$</span>
<span class="nv">$ </span>code .</code></pre></figure>

<h1 id="notes">Notes</h1>

<p>Interactive debugging works after creating a launch.json file for your project.   You can do this inside VScode by pressing Ctrl-Shift-d, and then following menus/prompts .   Select “haskell-debug-adapter” in the pull down menu that appears.  Initially, the test suite will be selected for debugging - to change this, replace “test/Spec.hs” in the “launch.json” file with “app/Main.hs” .</p>

<p>Even after going through the above process, interactive debugging did not work very well.  For example, stepping into code after hitting a breakpoint did not always work.</p>

  </div><a class="u-url" href="/2020/04/09/using-visual-studio-code-inside-docker-to-edit-haskell.html" hidden></a>
</article>

      </div>
    </main>

    <div class="page-content">
      <div class="wrapper">
        
    
<div id="gh-comments">
    <br/><br/>
    <h6>COMMENTS</h6>
    <div id="gh-comments-list"></div>
</div>

<script src="/js/github-comments.js"> </script>

<script type="text/javascript"> 
    DoGithubComments ( 
        "dc25/myBlog-comments" , 
        "11" 
    ); 
</script>

<noscript>Please enable JavaScript to view comments.</noscript>



      </div>
    </div><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194
                11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0
                13.806c0-1.21.983-2.195 2.194-2.195zM10.606
                16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"
              />
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li><a class="u-email" href="mailto:davecompton7@gmail.com">davecompton7@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>What I am doing, what I have done, and what I learned along the way.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
<!-- Default Statcounter code for Davecompton.net
https://davecompton.net -->
<script type="text/javascript">
var sc_project=11610177; 
var sc_invisible=1; 
var sc_security="d324e394"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="real time web
analytics" href="https://statcounter.com/"
target="_blank"><img class="statcounter"
src="https://c.statcounter.com/11610177/0/d324e394/1/"
alt="real time web analytics"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
<!-- End of Statcounter Code -->
</body>

</html>
